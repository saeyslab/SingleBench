
#' Create a heatmap of expression value medians per population
#'
#' Creates a heatmap showing expression value medians per each marker per each labelled population.
#'
#' @param benchmark object of type \code{Benchmark}, as generated by the constructor \code{Benchmark}
#' @param scale string: method of scaling heatmap colours ('row', 'column' or 'none). Default value is 'none'
#' @param display_numbers logical: whether to display numbers in the heatmap. Default value is \code{FALSE}
#' @param ... additional arguments to be passed to \code{pheatmap::pheatmap}
#'
#' @export
PlotPopulationHeatmap <- function(
  benchmark,
  scale = 'none',
  display_numbers = FALSE,
  ...
) {
  
  mfis <- .h5readLabelMedians(benchmark)
  
  args <- list(
    'mat' = mfis,
    'scale' = scale,
    'display_numbers' = display_numbers,
    'cluster_col' = FALSE,
    'cluster_row' = FALSE,
    'main' = paste0('Medians per population'),
    'silent' = TRUE
  )
  more_args <- list(...)
  for (name in names(more_args)) {
    args[[name]] <- more_args[[name]]
  }
  
  ph <- do.call(pheatmap::pheatmap, args)
  cowplot::plot_grid(ph[[4]])
}

#' Create a heatmap of expression value medians per cluster
#'
#' Creates a heatmap showing expression value medians per each cluster, taking clusters from a chosen subpipeline (and *n*-parameter iteration(s)).
#' If multiple *n*-parameter iterations are chosen, a list of plots is generated.
#'
#' @param benchmark object of type \code{Benchmark}, as generated by the constructor \code{Benchmark} and evaluated using \code{Evaluate}
#' @param idx.subpipeline integer value: index of subpipeline that includes a clustering step
#' @param idx.n_param integer: index of *n*-parameter(s) iteration of interest. Default value is \code{NULL}
#' @param idx.run integer: index of run if repeated. Default value is \code{1}
#' @param scale string: method of scaling heatmap colours ('row', 'column' or 'none). Default value is 'none'
#' @param display_numbers logical: whether to display numbers in the heatmap. Default value is \code{FALSE}
#' @param ... additional arguments to be passed to \code{pheatmap::pheatmap}
#'
#' @export
PlotClusterHeatmap <- function(
  benchmark,
  idx.subpipeline,
  idx.n_param = NULL,
  idx.run = 1,
  scale = 'none',
  display_numbers = FALSE,
  ...
) {
  
  if (class(benchmark) != 'Benchmark') stop('benchmark is not of class "Benchmark"')
  
  no_npar <- FALSE
  if (is.null(idx.n_param)) {
    no_npar <- TRUE
  }
  
  mfis <- .h5readClusterMedians(benchmark, idx.subpipeline, idx.n_param)
  name <- GetNParameterIterationName(benchmark, idx.subpipeline, idx.n_param)
  
  args <- list(
    'mat' = mfis,
    'scale' = scale,
    'display_numbers' = display_numbers,
    'cluster_col' = FALSE,
    'cluster_row' = FALSE,
    'main' = paste0('Medians per cluster: ', name),
    'silent' = TRUE
  )
  more_args <- list(...)
  for (name in names(more_args)) {
    args[[name]] <- more_args[[name]]
  }
  
  ph <- do.call(pheatmap::pheatmap, args)
  cowplot::plot_grid(ph[[4]])
}